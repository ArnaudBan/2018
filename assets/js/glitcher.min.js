function getRandomStripes() { for (var a = [0], t = 0, e = Math.round(10 * Math.random() + 5); t < e; t++)a.push(Math.random()); return a.push(1), a.sort() } function applyImageEffect(a) { var t = 20; a.crossOrigin = "anonymous"; var e = function (a) { var e = a.naturalWidth, n = a.naturalHeight, r = document.createElement("canvas"); r.width = e + t, r.height = n; var o = r.getContext("2d"); o.drawImage(a, 10, 0, e, n); var i = document.createElement("canvas"); i.width = e + t, i.height = n; var c = i.getContext("2d"), d = getRandomStripes(); d.forEach(function (r, o) { if (!(Math.random() < .5)) { var i = r * n, h = d[o + 1] * n - i; c.drawImage(a, 0, i, e, h, Math.random() * t, i, e, h) } }); var h = document.createElement("canvas"); h.width = e + t, h.height = n; var g = h.getContext("2d"); (d = getRandomStripes()).forEach(function (r, o) { if (!(Math.random() < .5)) { var i = r * n, c = d[o + 1] * n - i; g.drawImage(a, 0, i, e, c, Math.random() * t, i, e, c) } }); for (var m = o.getImageData(0, 0, e + t, n), l = c.getImageData(0, 0, e + t, n), u = g.getImageData(0, 0, e + t, n), s = l.data, f = u.data, p = m.width * m.height, v = 0; v < p; v++)s[4 * v] > 60 && (m.data[4 * v] += s[4 * v] / 2, m.data[4 * v + 3] = 255), f[4 * v + 2] > 80 && (m.data[4 * v + 2] += f[4 * v + 2] / 2, m.data[4 * v + 3] = 255); return o.clearRect(0, 0, e, n), o.putImageData(m, 0, 0), o.oldImage = m, r }(a); e.classList ? (e.classList.add("glitched"), e.classList.add("portrait")) : e.className += " glitched portrait", a.parentNode.replaceChild(e, a) } function glitch() { var a = document.querySelectorAll(".to-glitch"); imagesLoaded(a, function () { a.forEach(function (a) { applyImageEffect(a) }) }) } function applyCanvasDecale(a) { var t = a.getContext("2d"), e = getRandomStripes(); t.clearRect(0, 0, a.width, a.height), t.putImageData(t.oldImage, 0, 0), e.forEach(function (n, r) { if (!(Math.random() > .005)) { var o = n * a.height, i = e[r + 1] * a.height - o; t.drawImage(a, 0, o, a.width, i, 20 * Math.random() - 10, o, a.width, i) } }) } function decale() { document.querySelectorAll(".glitched").forEach(function (a) { applyCanvasDecale(a) }) } function repeatGlitchImage() { decale(), requestAnimationFrame(repeatGlitchImage) } var getFinalData = function (a, t, e) { var n = a.length, r = document.createElement("canvas"), o = r.getContext("2d"); for (r.width = t, r.height = e; n--;)o.drawImage(a[n], 0, 0, t, e); return r.toDataURL() }; requestAnimationFrame(repeatGlitchImage);